
# メソッド

ほとんどがこれまでの章の話題なのでREADMEだけで解説

## 必ず自身のクラスのインスタンス変数を使うこと

3章の話題

別のインスタンスにある変数を扱うような処理があるということはクラス設計に問題がある

クラス設計が良いと結果的にメソッドも良くなる

クラス設計とは結局「何のデータをまとめるか」に起因すると思う

## 不変をベースに予期せぬ動作を防ぐ関数にすること

4章の話題

なるべく定数で用意すること

変数があるということは「いつ」「どこで」「何」に変わるか分からない

boolの変数が3つあるだけで組み合わせは2^3=8パターンになり、それだけの動作確認が必要になる

定数であれば、用意した時の値が全てなのでそれ以外をあれこれ考える必要がなくなる

## 尋ねるな、命じろ

5章の話題

タイトルの意味はよく分かってないw

しかも `## 必ず自身のクラスのインスタンス変数を使うこと`と同じ話題な気がする

## コマンド・クエリ分離

状態(インスタンスのパラメータ)の変更と取得を同時にやらないようにする

負荷の都合などでどうしても同時にやる必要があることもあるが「そっちが例外」

どんな設計にも「例外」はある

しかし、例えば実装の3割以上が例外となると、それはもはや例外ではなく「無秩序」なだけ

例外を書く時はなぜその例外が必要なのかコメントとかで補足しておくといいと思う

## 引数

### 引数は不変にする

4章の話題

SwiftやDartや最近の言語は元から不変

つまり「引数は不変」であることがプログラミング(システム開発)において標準扱いであるべきという流れになった

### フラグ引数は使わない

6章の話題

メソッドの引数にフラグを入れて中で処理を分岐させるぐらいならメソッドを分けるなりストラテジーパターンにして切り替え可能な構造にしよう

### nullを渡さない

引数にnullを渡すと常にnullかどうか判断がいるし、その判断を忘れてnullにアクセスするとクラッシュする

SwiftやDartは`Null安全`という考え方でいわゆるOptional型がある

```null安全じゃない言語
// int型だがnull
int n;
// nullに足そうとしてクラッシュ
int m = n + 10
```

```null安全な言語
// Optionalなint型
int? n;
// Optional(nullの可能性があるのでそのまま足せない)
// ちゃんと「nullじゃないことを保証」させる必要がある
if n == NULL { 
  return;
}
int m = n + 10
```

Null安全な言語だとJavaほどnullを渡すなとは言い難い気もする

例えば生年月日を入力するフォームがある

変な入力なら「数値を入力してください」というアラートを出す

入力した値を消して空になったら「入力してください」というアラートを出す

初期状態 = 未入力 = null なら何もしない

とかだと、nullが必要

### 出力引数は使わない

5章の内容

```
func hoge(testClass: TestClass) {
 // testClassの中身を更新
}

let testClass = TestClass()

hoge(testClass: testClass)

// testClassの値を使って処理を続ける
```

メソッドの引数に代入したインスタンスなどの値を変えること
メソッドの出力値として利用するインスタンスを引数として使うから出力引数と呼んでるらしい

`### 引数は不変にする`と同じ話題

### 引数は可能な限り少なく

5章の話題

多くの引数がいるということはそれだけ中のロジックが多い

別のクラスや構造体に分けられないか考えよう

Microsoftの[Windowを作るメソッド](https://learn.microsoft.com/ja-jp/windows/win32/api/winuser/nf-winuser-createwindowexw)が見事に悪い例となっている

悪い例というか当時はこうするしかなかっただけだが

## 戻り値

### 「型」を使って戻り値の意図を明確に表明する

`int`,`string`などの言語自体が持ってるデータ型をプリミティブ型と呼ぶ

```
int getAge() {
  // 生年月日から年齢を返す
}

int getMoney() {
  // 所持金を返す
}

final age = getAge();
final money = getMoney();

age + money
```

プリミティブ型を返すと`年齢`と`金額`という別の概念の数を足すとかいうバグが起きる

何章かでこの話題もあった気がする...

### nullを返さない

引数にnullを渡すな、戻り値にもnullを渡すな

だがnull安全な言語だとそうじゃない場合もあるにはある

基本はnullがずっとつきまとうのは嫌だけど

### エラーは戻り値で返さない、例外をスローすること

これは自分もよくやりがち...

不正な値を表す`Location(-1, -1)`とやると、Locationインスタンスは常に使えるかどうか分からない状態がコードのあちこちにつきまとうことになる

インスタンスが生成できたということは`正常な状態`であることを保証した方がいい